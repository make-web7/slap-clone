SLAP-CLONE CODEBASE EXPLANATION (THOROUGH + SIMPLE)

==================================================
1) WHAT THIS PROJECT IS
==================================================
This project is a Slack-like chat app with:
- A Node.js/Express backend
- A React + Vite frontend
- Clerk for authentication
- Stream Chat for realtime chat features
- MongoDB for user storage
- Inngest for async event handling (user sync/deletion)
- Sentry for error monitoring

At a high level:
1. User signs in on frontend (Clerk)
2. Frontend requests a Stream token from backend
3. Backend verifies auth and generates Stream token
4. Frontend connects Stream Chat client with that token
5. User can open chat UI and message in channels


==================================================
2) REPO LAYOUT (IMPORTANT FILES)
==================================================
backend/
- instrument.mjs
- package.json
- vercel.json
- src/server.js
- src/config/env.js
- src/config/db.js
- src/config/inngest.js
- src/config/stream.js
- src/controllers/chat.controller.js
- src/middleware/auth.middleware.js
- src/models/user.model.js
- src/routes/chat.route.js

frontend/
- package.json
- vite.config.js
- eslint.config.js
- index.html
- src/main.jsx
- src/App.jsx
- src/index.css
- src/lib/axios.js
- src/lib/api.js
- src/providers/AuthProvider.jsx
- src/hooks/useStreamChat.js
- src/components/PageLoader.jsx
- src/components/CreateChannelModal.jsx
- src/pages/AuthPage.jsx
- src/pages/HomePage.jsx
- src/pages/CallPage.jsx
- src/styles/auth.css
- src/styles/stream-chat-theme.css


==================================================
3) BACKEND EXPLANATION
==================================================

3.1 backend/package.json
- Defines backend as an ES module project ("type": "module").
- Scripts:
  - dev: runs nodemon with Sentry instrumentation import
  - start: production-style node run with same instrumentation
- Main dependencies:
  - express: web API server
  - @clerk/express: auth middleware
  - mongoose: MongoDB access
  - stream-chat: Stream server SDK
  - inngest: event-driven background functions
  - @sentry/node: backend error monitoring
  - cors, dotenv: API access + env loading

3.2 backend/instrument.mjs
- Initializes Sentry as early as possible.
- Pulls DSN and environment from ENV config.
- Enables tracing/profiling and includes local vars/PII options.
- This file is imported via NODE_OPTIONS in scripts and directly in server.

3.3 backend/src/config/env.js
- Loads environment variables.
- Exposes an ENV object containing:
  - PORT, MONGO_URI, NODE_ENV
  - Clerk keys
  - Stream key + secret
  - Sentry DSN
  - Inngest keys
- Central place for env access across backend.

3.4 backend/src/config/db.js
- connectDB() connects to Mongo using ENV.MONGO_URI.
- Logs host on success.
- Exits process on failure.

3.5 backend/src/models/user.model.js
- Mongoose schema for users with fields:
  - email (required + unique)
  - name (required)
  - image (required)
  - clerkId (required + unique)
- Adds timestamps.
- Exports User model.

3.6 backend/src/config/stream.js
- Creates Stream client using API key/secret.
- Exposes:
  - checkStreamEnv(): returns secret/key string for debugging
  - upsertStreamUser(userData): create/update Stream user
  - deleteStreamUser(userId): remove Stream user
  - generateStreamToken(userId): creates Stream auth token

3.7 backend/src/config/inngest.js
- Creates Inngest client id "slap-clone".
- Defines two event handlers:
  1) syncUser on "clerk/user.created"
     - connect DB
     - build app user payload from Clerk event
     - upsert Mongo user by clerkId
     - upsert same user in Stream
  2) deleteUserFromDB on "clerk/user.deleted"
     - connect DB
     - delete Mongo user by clerkId
     - delete Stream user
- Exports functions array consumed by server route.

3.8 backend/src/middleware/auth.middleware.js
- protectRoute middleware checks Clerk auth state:
  - if not authenticated => 401
  - else continues

3.9 backend/src/controllers/chat.controller.js
- getStreamToken handler:
  - reads authenticated Clerk user id from req.auth()
  - generates Stream token
  - returns { token }
  - returns 500 if generation fails

3.10 backend/src/routes/chat.route.js
- Defines /token route:
  - GET /api/chat/token
  - protected by protectRoute
  - handled by getStreamToken

3.11 backend/src/server.js
- Builds Express app and wires middleware/routes:
  - clerkMiddleware for auth context
  - express.json
  - CORS for frontend origin (localhost:5173)
  - Inngest handler at /api/inngest
  - chat routes at /api/chat
  - Sentry express error handler
- Contains utility/test/debug routes:
  - /debug-sentry: throws test error
  - /test-stream: tests Stream upsert
  - /debug-stream-vars: prints stream env values
  - /: hello world
- startServer():
  - connectDB first
  - listen only when NODE_ENV is not production
  - exports app for hosting platforms

3.12 backend/vercel.json
- Vercel config mapping all routes to src/server.js.
- Sets NODE_ENV=development in Vercel env block.


==================================================
4) FRONTEND EXPLANATION
==================================================

4.1 frontend/package.json
- React app built with Vite.
- Main libraries:
  - @clerk/clerk-react for auth
  - @tanstack/react-query for data fetching/caching
  - stream-chat + stream-chat-react for messaging UI
  - react-router-dom for routing
  - @sentry/react for frontend monitoring
  - tailwindcss for utility styling (plus large custom CSS)

4.2 frontend/vite.config.js
- Enables React plugin and Tailwind Vite plugin.

4.3 frontend/eslint.config.js
- JS + React hooks + react-refresh linting.
- Ignores dist.
- Enforces no-unused-vars with common exception naming pattern.

4.4 frontend/index.html
- Basic Vite HTML shell with root div and main.jsx entry.

4.5 frontend/src/main.jsx
- App bootstrap.
- Initializes Sentry browser integration with React Router v7 tracing.
- Creates React Query client.
- Reads Clerk publishable key from env and throws if missing.
- Wrap order:
  StrictMode -> ClerkProvider -> BrowserRouter -> QueryClientProvider -> AuthProvider -> App -> Toaster

4.6 frontend/src/App.jsx
- Route gate based on Clerk auth state.
- Uses Sentry router wrapper.
- Routes:
  - / => HomePage if signed in, else redirect to /auth
  - /auth => AuthPage if signed out, else redirect to /
  - /call/:id => CallPage if signed in
  - * => fallback redirect based on auth state

4.7 frontend/src/lib/axios.js
- Creates shared Axios client.
- Base URL:
  - development => http://localhost:5001/api
  - production => deployed Vercel API URL
- withCredentials enabled.

4.8 frontend/src/providers/AuthProvider.jsx
- Installs Axios request interceptor.
- For each request:
  - obtains Clerk token via getToken()
  - sets Authorization: Bearer <token>
- Handles token/auth errors with toast + console logs.
- Ejects interceptor on cleanup.

4.9 frontend/src/lib/api.js
- getStreamToken() helper:
  - GET /chat/token using shared axios instance
  - returns response.data

4.10 frontend/src/hooks/useStreamChat.js
- Core chat connection hook.
- Uses React Query to fetch Stream token once user exists.
- On token + user + stream key:
  - gets Stream client instance
  - connects user with token
  - stores connected client in state
- On unmount/change:
  - disconnects user
- Returns { chatClient, isLoading, error }.
- Captures connect errors to Sentry.

4.11 frontend/src/pages/AuthPage.jsx
- Marketing/auth landing page.
- Shows logo, app pitch, feature list, and Clerk SignIn modal trigger.
- Styled by auth.css.

4.12 frontend/src/pages/HomePage.jsx
- Main chat page.
- Calls useStreamChat() to get connected Stream client.
- Reads "channel" query param and sets active channel.
- Shows loader while connecting.
- Renders Stream Chat layout:
  - left sidebar (branding, user button, create channel button)
  - main chat window (MessageList, MessageInput, Thread)
  - optional CreateChannelModal

4.13 frontend/src/components/PageLoader.jsx
- Simple full-page loading UI with animated icon.

4.14 frontend/src/components/CreateChannelModal.jsx
- Intended to create channels and manage members.
- Current file is incomplete/broken (details in Issues section below).
- Presently returns placeholder text div.

4.15 frontend/src/pages/CallPage.jsx
- Placeholder page for future call feature.

4.16 frontend styling files
- src/index.css: imports Tailwind.
- src/styles/auth.css:
  - custom full-screen split auth layout
  - glassmorphism + animated gradients + responsive behavior
- src/styles/stream-chat-theme.css:
  - imports Stream default theme then heavily customizes it
  - custom sidebar, channel previews, modal visuals, spacing, animations
  - large visual theme layer for Slack-like interface


==================================================
5) END-TO-END DATA FLOW
==================================================

5.1 Authentication Flow
1. User opens frontend.
2. ClerkProvider controls sign-in state.
3. App routes user to /auth if signed out.
4. After sign-in, Clerk session exists in browser.

5.2 Backend Authorization Flow
1. AuthProvider attaches Clerk Bearer token to Axios requests.
2. Backend uses clerkMiddleware().
3. protectRoute checks req.auth().isAuthenticated.
4. Protected endpoints only continue for authenticated users.

5.3 Stream Token Flow
1. Frontend useStreamChat() calls getStreamToken() via React Query.
2. Request goes to GET /api/chat/token.
3. Backend generates Stream token from Clerk user id.
4. Frontend receives token and connects Stream client.
5. Chat UI becomes active.

5.4 User Sync Flow (events)
1. Clerk emits user.created / user.deleted webhooks/events.
2. Inngest endpoint receives event.
3. Inngest function updates Mongo user records.
4. Inngest function mirrors user in Stream (upsert/delete).


==================================================
6) CURRENT ISSUES / INCOMPLETE PARTS
==================================================
These are important because they affect runtime behavior.

6.1 CreateChannelModal.jsx has multiple code problems
- `client.queryUsers` call syntax is malformed.
- `Sentry` is used but not imported.
- `fetchUsers` function is defined but never called in useEffect.
- Stray character `c` in component body.
- `setChannelname` typo (should be setChannelName).
- Name validation conditions are reversed/incorrect:
  - `if (!name.trim().length < 3)` etc.
- `handleSubmit` computes channelId but does not actually create/watch channel.
- Component returns only `<div>CreateChannelModal</div>` (no real modal UI).

6.2 HomePage does not render ChannelList component
- `ChannelList` is imported but not rendered.
- Active channel relies on URL param; without channel list/channel creation completion, UX is limited.

6.3 PageLoader class typo
- Uses `mine-h-screen` instead of `min-h-screen`.
- Loader may not occupy full viewport as intended.

6.4 Backend debug endpoints expose sensitive behavior
- `/debug-stream-vars` returns API secret/key values.
- `/test-stream` creates users and may leak internals in error responses.
- Good for local debugging, risky for production if left enabled.

6.5 Minor server cleanliness issues
- `instrument.mjs` imported twice in server.js.
- Unused imports in a few places (not breaking but noisy).


==================================================
7) ENVIRONMENT VARIABLES YOU RELY ON
==================================================
Backend expects:
- PORT
- MONGO_URI
- NODE_ENV
- CLERK_PUBLISHABLE_KEY
- CLERK_SECRET_KEY
- STREAM_API_SECRET
- STREAM_API_KEY
- SENTRY_DSN
- INNGEST_EVENT_KEY
- INNGEST_SIGNING_KEY

Frontend expects:
- VITE_CLERK_PUBLISHABLE_KEY
- VITE_STREAM_API_KEY

If these are missing, auth/chat/monitoring features break.


==================================================
8) SIMPLE SUMMARY
==================================================
You built a chat app foundation with strong core integrations:
- Clerk auth
- Stream chat tokens + client connection
- Mongo user model
- Inngest user lifecycle sync
- Sentry monitoring

The main architecture is correct, and the largest unfinished area is channel creation UI/logic (`CreateChannelModal.jsx`) plus a few cleanup/safety issues around debug routes and small typos.
